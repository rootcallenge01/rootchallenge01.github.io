<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Stronghold Codex — Gate Closed</title>
  <meta name="robots" content="noindex,nofollow">
  <!-- Orbitron only for typed text -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0f14; --ink:#cfd7df; --muted:#93a1b1; --gold:#bfa76a;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; background:#000; color:var(--ink);
         font-family:sans-serif; display:flex; align-items:center; justify-content:center}
    .wrap{max-width:900px; width:100%; padding:28px}
    .center{display:flex; flex-direction:column; align-items:center}
    img{width:280px; height:auto; filter:drop-shadow(0 0 22px rgba(191,167,106,.25))}
    h1{margin:12px 0 6px; font-size:20px; letter-spacing:.14em; text-transform:uppercase; color:var(--gold)}
    .tag{margin:8px 0 20px; color:var(--muted); font-size:18px; text-align:center}
    .divider{height:1px; margin:8px 0 24px; background:linear-gradient(90deg,transparent, rgba(191,167,106,.45), transparent)}
    .panel{border:1px solid rgba(191,167,106,.25); border-radius:18px; background:rgba(191,167,106,.06); padding:18px 18px 22px}
    .label{display:inline-block; margin-bottom:8px; color:var(--gold); font-variant:small-caps; letter-spacing:.06em}
    .typed{white-space:pre-wrap; font-size:22px; line-height:1.5; min-height:5.5em; font-family:'Orbitron', sans-serif;}
    .sig{margin-top:12px; color:var(--gold); font-size:15px; text-align:center}
    .fade-out{animation: fadeOut 3s forwards;}
    @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
    .final-message { display:none; font-size: 20px; color: var(--gold); text-align:center; }
    #countdown { margin-top:12px; font-size:18px; color:var(--ink); }
  </style>
</head>
<body>
  <main class="wrap" aria-live="polite" id="main-content">
    <div class="center">
      <img src="assets/stronghold-logo.png" alt="Stronghold crest">
      <h1>The Stronghold Codex — Gate Closed</h1>
      <div class="tag">Stronghold stands; its soul waits outside linear time.</div>
      <div id="countdown"></div>
      <div class="divider" aria-hidden="true"></div>
    </div>
    <section class="panel">
      <span class="label">Entry 0 — The Root Challenge</span>
      <div id="typed" class="typed"></div>
    </section>
    <div class="sig">— Within the Command Spine</div>
  </main>

  <div id="final-message" class="final-message">Return when the truth is ready to pass the Gate.</div>

  <script>
    (function(){
      const KEY = 'stronghold_gate_runs_v1';

      if(location.search.includes('reset=1')){
        try{ localStorage.removeItem(KEY); }catch(e){}
        const url = location.origin + location.pathname;
        history.replaceState({}, '', url);
      }

      // Countdown target: 13 April 2026, 12:01 AM AEST (UTC+10, so 02:01 UTC)
      const targetUTC = Date.UTC(2026, 3, 13, 2, 1, 0);
      function two(n){ return n<10 ? '0'+n : ''+n; }
      function renderCountdown(el){
        const now = new Date();
        let diff = Math.max(0, targetUTC - now.getTime());
        const d = Math.floor(diff / (1000*60*60*24)); diff -= d*(1000*60*60*24);
        const h = Math.floor(diff / (1000*60*60)); diff -= h*(1000*60*60);
        const m = Math.floor(diff / (1000*60)); diff -= m*(1000*60);
        const s = Math.floor(diff / 1000);
        el.textContent = `${d}d:${two(h)}h:${two(m)}m:${two(s)}s  (13 Apr 2026 — 12:01 AEST)`;
      }

      const cd = document.getElementById('countdown');
      if(cd){ renderCountdown(cd); setInterval(()=>renderCountdown(cd), 1000); }

      let runs = 0;
      try{
        runs = parseInt(localStorage.getItem(KEY) || '0', 10);
        if(runs >= 3){
          document.getElementById('main-content').style.display='none';
          document.getElementById('final-message').style.display='flex';
          return;
        }
      }catch(e){}

      const mainContent = document.getElementById('main-content');
      const finalMessage = document.getElementById('final-message');
      const out = document.getElementById('typed');

      const text = `The gate will open
to three truths
spoken in the right order.

The first must bind a people.
The second must break a tyrant.
The third must outlast time.

Name them.`;

      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function endSequence(){
        mainContent.classList.add('fade-out');
        setTimeout(()=>{
          mainContent.style.display='none';
          finalMessage.style.display='flex';
          try{
            const current = parseInt(localStorage.getItem(KEY) || '0', 10);
            localStorage.setItem(KEY, String((isNaN(current)?0:current) + 1));
          }catch(e){}
        }, 3000);
      }

      function afterTyping(){
        setTimeout(endSequence, 10000);
      }

      if(prefersReduced){
        out.textContent = text;
        afterTyping();
      } else {
        let i = 0;
        const delay = 72; // slowed typing
        const timer = setInterval(()=>{
          out.textContent = text.slice(0, ++i);
          if(i>=text.length){ clearInterval(timer); afterTyping(); }
        }, delay);
      }
    })();
  </script>
</body>
</html>
